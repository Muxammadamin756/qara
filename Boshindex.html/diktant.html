<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Diktant - Zamonaviy</title>
    <link rel="stylesheet" href="../Boshindex.html/stayle.css" />
    <style>
        /* Zamonaviy, responsiv dizayn */
        :root {
            --brand: #00c3ff;
            --bg: #0f1724;
            --card: #0b1220;
            --muted: #94a3b8;
        }

        body {
            margin: 0;
            font-family: Inter, Segoe UI, Arial, sans-serif;
            background: linear-gradient(180deg, #071226 0%, #071b2b 60%);
            color: #e6eef8;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 18px;
        }

        nav {
            width: 100%;
            max-width: 980px;
            margin-bottom: 12px;
            text-align: center;
        }

        nav a {
            color: var(--brand);
            text-decoration: none;
            margin: 0 8px;
            padding: 6px 10px;
            border-radius: 8px;
            font-weight: 600
        }

        nav a.active,
        nav a:hover {
            background: rgba(0, 195, 255, 0.12);
            color: #fff
        }

        .wrap {
            width: 100%;
            max-width: 980px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
            border-radius: 14px;
            padding: 20px;
            box-shadow: 0 8px 30px rgba(2, 6, 23, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.03);
        }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px
        }

        h1 {
            font-size: 1.25rem;
            margin: 0;
            color: #fff
        }

        .controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center
        }

        .btn {
            background: var(--brand);
            color: #001;
            border: none;
            padding: 8px 12px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 6px 18px rgba(0, 195, 255, 0.12);
            transition: transform .12s
        }

        .btn.secondary {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.06);
            color: var(--muted);
            font-weight: 600
        }

        .btn:active {
            transform: translateY(1px)
        }

        .area {
            margin-top: 18px;
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 18px
        }

        .panel {
            background: var(--card);
            padding: 14px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.03)
        }

        .player-title {
            color: var(--muted);
            font-size: .95rem;
            margin-bottom: 8px
        }

        textarea {
            width: 100%;
            min-height: 140px;
            background: transparent;
            border: 1px dashed rgba(255, 255, 255, 0.04);
            color: #eaf6ff;
            padding: 12px;
            border-radius: 8px;
            resize: vertical;
            font-size: 1rem
        }

        .meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            color: var(--muted);
            font-size: .95rem
        }

        .small {
            font-size: .92rem;
            color: var(--muted)
        }

        .score {
            font-weight: 800;
            color: var(--brand)
        }

        .right-column {
            display: flex;
            flex-direction: column;
            gap: 10px
        }

        .sentence-box {
            font-size: 1.8rem;
            text-align: center;
            direction: rtl;
            padding: 14px;
            border-radius: 10px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.01), rgba(255, 255, 255, 0.02));
            color: #fff;
        }

        /* translation (Uzbek) style */
        .translation {
            margin-top: 10px;
            font-size: 1rem;
            color: var(--muted);
            direction: ltr;
            text-align: center;
        }

        .controls-row {
            display: flex;
            gap: 8px;
            justify-content: center;
            align-items: center
        }

        .record-ind {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #7f8c8d;
            margin-left: 8px
        }

        .record-ind.on {
            background: #f33;
            box-shadow: 0 0 12px #f33
        }

        footer {
            margin-top: 18px;
            text-align: center;
            color: var(--muted);
            font-size: .9rem
        }

        @media (max-width:880px) {
            .area {
                grid-template-columns: 1fr;
            }

            .right-column {
                order: 2
            }
        }

        @media (max-width:420px) {
            h1 {
                font-size: 1rem
            }

            .btn {
                padding: 8px 10px
            }
        }
    </style>
</head>

<body>
    <nav>
        <a href="/Boshindex.html/index.html">Bosh sahifa</a>


        <a href="./diktant.html" class="active">Diktant</a>
        <a href="./profil.html">Profil</a>
        <a href="./foydali_soz.html">Foydali so‘zlar</a>
        <a href="./alifbe.html">Arab Alifbosi</a>
    </nav>

    <div class="wrap">
        <header>
            <h1>Diktant — tingla, yoz va tekshir</h1>
            <div class="controls">
                <button id="playBtn" class="btn">🔊 Tingla</button>
                <button id="nextBtn" class="btn secondary">Keyingi</button>
                <button id="checkBtn" class="btn">Tekshir</button>
                <button id="showBtn" class="btn secondary">Javobni ko'rsat</button>
            </div>
        </header>

        <div class="area">
            <div class="panel">
                <div class="player-title">Siz eshitganlarni shu yerga yozing:</div>
                <textarea id="answer" placeholder="Bu yerga arabcha gapni yozing..."></textarea>
                <div class="meta">
                    <div class="small">So'rovlar: <span id="round">0</span>/<span id="total">0</span></div>
                    <div class="small">Ball: <span id="score" class="score">0</span></div>
                </div>
                <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
                    <button id="recordStart" class="btn secondary">🎤 Yozib oling</button>
                    <button id="recordStop" class="btn secondary">⏹ To'xtat</button>
                    <button id="playRec" class="btn secondary">▶ Tinglash</button>
                    <div id="recStatus" class="small" style="align-self:center">Status: <span id="recText">tayyor</span>
                        <span id="recDot" class="record-ind"></span>
                    </div>
                </div>
            </div>

            <div class="right-column">
                <div class="panel">
                    <div class="player-title">Hozirgi gap (sir tutiladi)</div>
                    <div id="sentenceBox" class="sentence-box">———</div>

                    <div style="margin-top:10px;text-align:center" class="controls-row">
                        <button id="replayBtn" class="btn secondary">🔁 Qayta tingla</button>
                        <button id="revealBtn" class="btn">👁‍🗨 Ko'rsat</button>
                    </div>
                </div>

                <div class="panel">
                    <div class="player-title">Sozlamalar</div>
                    <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
                        <label class="small">Takrorlashlar: <input id="repeatCount" type="number" min="1" max="5"
                                value="2" style="width:60px;margin-left:8px"></label>
                        <label class="small">Til (ovoz):
                            <select id="voiceSelect">
                                <option value="ar-SA">Arabic (Saudi)</option>
                                <option value="ar-EG">Arabic (Egypt)</option>
                            </select>
                        </label>
                        <label class="small">Seans uzunligi:
                            <select id="lenSelect">
                                <option value="5">5 ta gap</option>
                                <option value="10" selected>10 ta gap</option>
                                <option value="15">15 ta gap</option>
                            </select>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <footer>Mobil uchun mos va zamonaviy dizayn · Dastlabki versiya</footer>
    </div>

    <script>
        // Sadə zamonaviy diktant funksionalligi
        // har bir element — arabcha gap va uning o'zbek tarjimasi
        const sentences = [
            { ar: "السَّلَامُ عَلَيْكُمْ", uz: "Assalomu alaykum" },
            { ar: "كَيْفَ حَالُكَ؟", uz: "Qalaysiz? / Qanday ahvolda siz?" },
            { ar: "أَيْنَ الْمَكْتَبُ؟", uz: "Ofis qayerda?" },
            { ar: "هَذَا كِتَابٌ جَدِيدٌ", uz: "Bu yangi kitob." },
            { ar: "أُحِبُّ تَعَلُّمَ الْعَرَبِيَّةِ", uz: "Men arab tilini o'rganishni yaxshi ko'raman." },
            { ar: "الطَّقْسُ جَمِيلٌ الْيَوْمَ", uz: "Bugun havo go'zal." },
            { ar: "هَلْ أَنْتَ مُسْتَعِدٌّ؟", uz: "Siz tayyormisiz?" },
            { ar: "شُكْرًا جَزِيلًا", uz: "Katta rahmat." },
            { ar: "مَوْعِدُنَا فِي السَّاعَةِ الثَّالِثَةِ", uz: "Bizning uchrashuv uchinchi soatda." },
            { ar: "أَيْنَ الْحَمَّامُ؟", uz: "Hammom qayerda?" },
            { ar: "هَذِهِ سَيَّارَةٌ سَرِيعَةٌ", uz: "Bu tez avtomobil." },
            { ar: "أَذْهَبُ إِلَى الْمَدْرَسَةِ", uz: "Men maktabga boraman." }
        ];

        // UI elems
        const playBtn = document.getElementById('playBtn');
        const replayBtn = document.getElementById('replayBtn');
        const nextBtn = document.getElementById('nextBtn');
        const checkBtn = document.getElementById('checkBtn');
        const showBtn = document.getElementById('showBtn');
        const revealBtn = document.getElementById('revealBtn');
        const sentenceBox = document.getElementById('sentenceBox');
        const answer = document.getElementById('answer');
        const roundEl = document.getElementById('round');
        const totalEl = document.getElementById('total');
        const scoreEl = document.getElementById('score');
        const repeatCount = document.getElementById('repeatCount');
        const voiceSelect = document.getElementById('voiceSelect');
        const lenSelect = document.getElementById('lenSelect');
        const recStart = document.getElementById('recordStart');
        const recStop = document.getElementById('recordStop');
        const playRec = document.getElementById('playRec');
        const recText = document.getElementById('recText');
        const recDot = document.getElementById('recDot');

        let pool = [];
        let currentIdx = -1;
        let score = 0;
        let rounds = 10;
        let mediaRecorder, audioBlob, audioUrl;

        function pickPool(n) {
            const arr = [...sentences];
            shuffle(arr);
            pool = arr.slice(0, n);
            totalEl.textContent = pool.length;
            roundEl.textContent = 0;
            score = 0;
            scoreEl.textContent = score;
            currentIdx = -1;
            sentenceBox.textContent = "———";
            answer.value = "";
        }

        function shuffle(a) {
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
        }

        function next() {
            if (pool.length === 0) pickPool(rounds);
            currentIdx++;
            if (currentIdx >= pool.length) {
                currentIdx = 0;
                pickPool(rounds);
            }
            roundEl.textContent = currentIdx + 1;
            answer.value = "";
            // savolni va uning o'zbek tarjimasini ko'rsatamiz (audio yo'q)
            sentenceBox.innerHTML = `
                <div style="font-size:1.6rem;">${pool[currentIdx].ar}</div>
                <div class="translation">${pool[currentIdx].uz}</div>
            `;
        }

        // audio funksiyalari qilib qoladi, lekin hozircha bo'sh (hech nima qilmaydi)
        function speakSentence(text) {
            // audio o'chirilgan — hech narsa qilmaydi
        }

        function speak(text, lang = 'ar-SA') {
            // audio o'chirilgan — hech narsa qilmaydi
        }

        function normalize(s) {
            return s.toLowerCase().replace(/[\u064B-\u0652]/g, '') // remove Arabic diacritics
                .replace(/[^\p{L}\p{N}]+/gu, '').trim();
        }

        function check() {
            if (currentIdx < 0) return;
            const user = normalize(answer.value);
            const correct = normalize(pool[currentIdx].ar);
            if (!user) {
                alert("Iltimos yozing.");
                return;
            }
            if (user === correct) {
                score += 1;
                scoreEl.textContent = score;
                flash("To'g'ri ✓", true);
            } else {
                flash("Noto'g'ri ✗  —  To'g'ri: " + pool[currentIdx].ar + " — " + pool[currentIdx].uz, false);
            }
            setTimeout(next, 900);
        }

        function flash(msg, ok) {
            const prev = document.createElement('div');
            prev.textContent = msg;
            prev.style.position = 'fixed';
            prev.style.right = '18px';
            prev.style.top = '18px';
            prev.style.padding = '10px 14px';
            prev.style.borderRadius = '10px';
            prev.style.background = ok ? "linear-gradient(90deg,#0ff, #0af)" : "linear-gradient(90deg,#f66,#c33)";
            prev.style.color = '#001';
            prev.style.zIndex = 9999;
            document.body.appendChild(prev);
            setTimeout(() => prev.remove(), 1400);
        }

        function reveal() {
            if (currentIdx < 0) return;
            // ko'rsatganda arabcha va uning o'zbek tarjimasini chiqazamiz
            sentenceBox.innerHTML = `
                <div style="font-size:1.6rem;">${pool[currentIdx].ar}</div>
                <div class="translation">${pool[currentIdx].uz}</div>
            `;
        }

        // Recording (optional pronunciation recording)
        recStart.onclick = async () => {
            if (!navigator.mediaDevices) return alert("Mikrofon qo'llab-quvvatlanmaydi");
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                const chunks = [];
                mediaRecorder.ondataavailable = e => chunks.push(e.data);
                mediaRecorder.onstop = () => {
                    audioBlob = new Blob(chunks, { type: 'audio/webm' });
                    audioUrl = URL.createObjectURL(audioBlob);
                    recText.textContent = "saqlandi";
                    recDot.classList.add('on');
                }
                mediaRecorder.start();
                recText.textContent = "yozilmoqda";
                recDot.classList.add('on');
            } catch (e) {
                alert("Mikrofonga ruxsat berilmadi");
            }
        };
        recStop.onclick = () => { if (mediaRecorder && mediaRecorder.state === 'recording') mediaRecorder.stop(); recDot.classList.remove('on'); };
        playRec.onclick = () => { if (audioUrl) new Audio(audioUrl).play(); else alert("Oldin yozing"); };

        // Wire buttons
        playBtn.onclick = () => {
            if (currentIdx < 0) next(); else {
                // qayta ko'rsatish (hech qanday audio bo'lmaydi)
                sentenceBox.innerHTML = `
                <div style="font-size:1.6rem;">${pool[currentIdx].ar}</div>
                <div class="translation">${pool[currentIdx].uz}</div>
            `;
            }
        }
        replayBtn.onclick = () => {
            if (currentIdx >= 0) {
                sentenceBox.innerHTML = `
                <div style="font-size:1.6rem;">${pool[currentIdx].ar}</div>
                <div class="translation">${pool[currentIdx].uz}</div>
            `;
            } else alert("Avval gapni boshlang");
        }
        nextBtn.onclick = () => next();
        checkBtn.onclick = () => check();
        showBtn.onclick = () => reveal();
        revealBtn.onclick = () => reveal();

        // init
        lenSelect.onchange = () => {
            rounds = parseInt(lenSelect.value, 10) || 10;
            pickPool(rounds);
        };

        // start default
        rounds = parseInt(lenSelect.value, 10) || 10;
        pickPool(rounds);

        // keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) { check(); }
            if (e.key === ' ' && document.activeElement.tagName !== 'TEXTAREA') { e.preventDefault(); playBtn.click(); }
        });
    </script>
</body>

</html>